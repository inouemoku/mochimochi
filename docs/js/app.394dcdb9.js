(function(e){function t(t){for(var i,l,o=t[0],r=t[1],c=t[2],m=0,u=[];m<o.length;m++)l=o[m],Object.prototype.hasOwnProperty.call(a,l)&&a[l]&&u.push(a[l][0]),a[l]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);d&&d(t);while(u.length)u.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],i=!0,o=1;o<s.length;o++){var r=s[o];0!==a[r]&&(i=!1)}i&&(n.splice(t--,1),e=l(l.s=s[0]))}return e}var i={},a={app:0},n=[];function l(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,l),s.l=!0,s.exports}l.m=e,l.c=i,l.d=function(e,t,s){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)l.d(s,i,function(t){return e[t]}.bind(null,i));return s},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],r=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=r;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0211":function(e,t,s){"use strict";s("061c")},"061c":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var i=s("2b0e"),a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("div",{staticClass:"container-fluid"},[s("h3",{staticClass:"my-3"},[e._v("MochiMochi - ココフォリアログ整形ツール")]),e._m(0),s("div",{staticClass:"row mt-3"},[s("div",{staticClass:"col-md-12"},[s("ccfolia-formatter")],1)])])])},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("small",[e._v(" 自分用に作ったログ整形ツールです。ココフォリアのログファイルを読み込ませて「整形！」ボタンを押すとダウンロードできます。"),s("br"),e._v(" 「整形しないでダウンロード」ボタンを押すと元の形式のままダウンロードできます。選択したタブとシークレットダイスだけ反映されます。"),s("br"),e._v(" システムに「その他」以外を選択した場合は、ダイス結果も見られます。 ")])}],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-form",{ref:"ccfoliaLog",staticClass:"mb-5",attrs:{model:e.ccfoliaLog}},[s("system-form",{on:{select:e.selectSystem}}),s("el-form-item",{attrs:{prop:"file"}},[s("el-upload",{attrs:{drag:"",action:"","auto-upload":!1,"on-change":e.handleChangeFile}},[s("i",{staticClass:"el-icon-upload"}),s("div",{staticClass:"el-upload__text"},[e._v("Drop file here or "),s("em",[e._v("click to upload")])])])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:e.ccfoliaLog.rows.length>0,expression:"ccfoliaLog.rows.length > 0"}]},[s("dice-result",{attrs:{visible:"other"!=e.ccfoliaLog.system,system:e.system,names:e.names,initialSelectedNameTabs:e.selectedNameTabs,ccfoliaLog:e.ccfoliaLog}}),s("header-setting",{attrs:{initialHeaderColor1:e.ccfoliaLog.header_color1,initialHeaderColor2:e.ccfoliaLog.header_color2,initialLinkColor:e.ccfoliaLog.link_color,initialTitle:e.ccfoliaLog.title,dividerRows:e.dividerRows},on:{changeHeaderColor1:e.changeHeaderColor1,changeHeaderColor2:e.changeHeaderColor2,changeLinkColor:e.changeLinkColor,changeTitle:e.changeTitle}}),s("tab-setting",{attrs:{ccfoliaLog:e.ccfoliaLog,initialSelectedOutputTabs:e.selectedOutputTabs,inisitalIsHideSecretDice:e.isHideSecretDice},on:{changeIsHideSecretDice:e.changeIsHideSecretDice,changeSelectedOutputTabs:e.changeSelectedOutputTabs}}),s("log-editor",{attrs:{initialCcfoliaLog:e.ccfoliaLog,selectedOutputTabs:e.selectedOutputTabs,dividerRows:e.dividerRows},on:{changeCcfoliaLog:e.changeCcfoliaLog}})],1),s("el-tooltip",{attrs:{placement:"top-start"}},[s("div",{attrs:{slot:"content"},slot:"content"},[e._v("ヘッダーやタブなど全ての設定が反映されます。")]),s("el-button",{staticClass:"px-5",attrs:{type:"primary",disabled:e.ccfoliaLog.rows.length<=0},on:{click:e.postCcfoliaLog}},[e._v("整形！")])],1),s("el-tooltip",{attrs:{placement:"top-start"}},[s("div",{attrs:{slot:"content"},slot:"content"},[e._v("タブとシークレットダイスの設定だけ反映されます。")]),s("el-button",{staticClass:"px-5",attrs:{type:"warning",disabled:e.ccfoliaLog.rows.length<=0},on:{click:e.postOriginalCcfoliaLog}},[e._v("整形しないでダウンロード")])],1)],1),s("el-divider"),s("histories")],1)},o=[],r=(s("13d5"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-form-item",{attrs:{prop:"system"}},[s("el-select",{model:{value:e.selectedSystem,callback:function(t){e.selectedSystem=t},expression:"selectedSystem"}},e._l(e.systems,(function(e){return s("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1)],1)}),c=[],d={data(){return{predefineColors:["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585"],systems:[{key:"coc6",prefix:"【CoC】",name:"クトゥルフ神話TRPG",diceText:"Cthulhu",diceResults:[{key:"critical",name:"決定的成功"},{key:"famble",name:"致命的失敗"},{key:"special",name:"スペシャル"},{key:"success",name:"成功"},{key:"failed",name:"失敗"}],diceTypes:[{resultKey:"critical",name:"決定的成功",class:"success"},{resultKey:"famble",name:"致命的失敗",class:"failed"},{resultKey:"special",name:"スペシャル",class:"success"},{resultKey:"success",name:"成功",class:"success"},{resultKey:"success",name:"部分的成功",class:"success"},{resultKey:"failed",name:"失敗",class:"failed"},{resultKey:"failed",name:"故障",class:"failed"}]},{key:"emoklore",prefix:"【エモクロア】",name:"エモクロアTRPG",diceText:"Emoklore",diceResults:[{key:"catastrophe",name:"カタストロフ"},{key:"miracle",name:"ミラクル"},{key:"triple",name:"トリプル"},{key:"double",name:"ダブル"},{key:"success",name:"シングル"},{key:"failed",name:"失敗"},{key:"famble",name:"ファンブル"}],diceTypes:[{resultKey:"catastrophe",name:"カタストロフ!",class:"success"},{resultKey:"miracle",name:"ミラクル!",class:"success"},{resultKey:"triple",name:"トリプル!",class:"success"},{resultKey:"double",name:"ダブル!",class:"success"},{resultKey:"success",name:"成功!",class:"success"},{resultKey:"failed",name:"失敗!",class:"failed"},{resultKey:"famble",name:"ファンブル!",class:"failed"}]},{key:"insane",prefix:"【インセイン】",name:"インセイン",diceText:"Insane",diceResults:[{key:"special",name:"スペシャル"},{key:"success",name:"成功"},{key:"failed",name:"失敗"},{key:"famble",name:"ファンブル"}],diceTypes:[{resultKey:"famble",name:"ファンブル",class:"failed"},{resultKey:"special",name:"スペシャル",class:"success"},{resultKey:"success",name:"成功",class:"success"},{resultKey:"failed",name:"失敗",class:"failed"}]},{key:"shinobigami",prefix:"【シノビガミ】",name:"シノビガミ",diceText:"ShinobiGami",diceResults:[{key:"special",name:"スペシャル"},{key:"success",name:"成功"},{key:"failed",name:"失敗"},{key:"famble",name:"ファンブル"}],diceTypes:[{resultKey:"famble",name:"ファンブル",class:"failed"},{resultKey:"special",name:"スペシャル",class:"success"},{resultKey:"success",name:"成功",class:"success"},{resultKey:"failed",name:"失敗",class:"failed"}]},{key:"other",prefix:"",name:"その他",diceText:"",diceResults:[],diceTypes:[]}]}},methods:{backgroundColor(e){return"メイン"==e?"#ffffff":"雑談"==e?"#f7f7f7":"情報"==e?"#fafafa":this.ccfoliaLog.tabs.find(t=>t.name==e).background_color}}},m={name:"SystemForm",mixins:[d],props:{initialSystem:{type:String,default:"coc6"}},data(){return{selectedSystem:this.initialSystem}},watch:{selectedSystem:function(e){this.$emit("select",e)}}},u=m,h=s("2877"),p=Object(h["a"])(u,r,c,!1,null,null,null),f=p.exports,b=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.visible?s("el-card",{staticClass:"mb-3",attrs:{shadow:"never"}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v("ダイス結果 "),s("el-tooltip",{attrs:{effect:"dark",placement:"top-start",content:"ダイス結果だけまとめて見られます。"}},[s("el-button",{attrs:{icon:"el-icon-question",type:"text"}})],1)],1)]),s("el-radio-group",{attrs:{size:"mini"},model:{value:e.selectedDiceResult,callback:function(t){e.selectedDiceResult=t},expression:"selectedDiceResult"}},e._l(e.system.diceResults,(function(t){return s("el-radio-button",{key:t.key,attrs:{label:t.key}},[e._v(e._s(t.name))])})),1),s("el-checkbox-group",{model:{value:e.selectedDiceTabs,callback:function(t){e.selectedDiceTabs=t},expression:"selectedDiceTabs"}},[s("el-checkbox",{attrs:{label:"メイン"}}),s("el-checkbox",{attrs:{label:"情報"}}),s("el-checkbox",{attrs:{label:"雑談"}}),e._l(e.ccfoliaLog.tabs,(function(e,t){return s("el-checkbox",{key:t,attrs:{label:e.name}})}))],2),s("el-checkbox-group",{model:{value:e.selectedNameTabs,callback:function(t){e.selectedNameTabs=t},expression:"selectedNameTabs"}},e._l(e.names,(function(e,t){return s("el-checkbox",{key:t,attrs:{label:e}})})),1),s("small",[e._v("計")]),e._v(" "+e._s(e.diceRows.length)+" "),s("small",[e._v("回")]),e._l(e.diceRows,(function(t,i){return s("div",{key:i},[s("div",{style:"color:"+t.color},[e._v(" ["+e._s(t.tab_name)+"] "+e._s(t.name)+"： "),s("span",{domProps:{innerHTML:e._s(t.body)}})])])}))],2):e._e()},_=[];class y{constructor(e=null){this._key=this.paramFromObject(e,"key"),this._color=this.paramFromObject(e,"color"),this._tab_name=this.paramFromObject(e,"tab_name"),this._name=this.paramFromObject(e,"name"),this._body=this.paramFromObject(e,"body"),this._is_divider=this.paramFromObject(e,"is_divider"),this._dice_type=this.paramFromObject(e,"dice_type"),this._is_oneline=this.paramFromObject(e,"is_oneline"),this._is_secret=this.paramFromObject(e,"is_secret")}paramFromObject(e,t,s=null){return null==e||null==e[t]?s:e[t]}format(e,t,s,i){if(this.is_divider)return`    <h2 id="key${this.key}" class="day">${this.body}</h2><hr class="day-line">\n`;if(!s.includes(this.tab_name))return"";const a=this.formatBySystem(e,i);return`      <div class="${this.class_name(t)}" style="color:${this.color};" tab-name="${this.htmlSpecialChars(this.tab_name)}">\n        <span class="name-field"><span class="name"><span>${this.name}</span> :</span></span>\n        <span class="text">${a}</span>\n      </div>\n`}htmlSpecialChars(e){var t=document.createTextNode(e),s=document.createElement("p");return s.appendChild(t),s.innerHTML}notFormat(e,t){if(!e.includes(this.tab_name))return"";const s=t&&this.is_secret?"シークレットダイス":this.body;return`    <p style="color:${this.color};">\n      <span> [${this.tab_name}]</span>\n      <span>${this.name}</span> :\n      <span>${s}</span>\n    </p>\n    \n`}formatBySystem(e,t){if(t&&this.is_secret)return"シークレットダイス";const s=this.dice_type?this.dice_type.class:"";if("coc6"==e)return this.is_oneline?this.body.replace(/(.*)\((.*)\)(.*)＞ (.*)/,`$1<br>\n<span class="dice ${s}">($2)$3＞ $4</span>`):this.body.replace(/(.*)\nCthulhu : (.*)/,`$1<br>\n<span class="dice ${s}">Cthulhu :$2\n</span>`);if("emoklore"==e||"insane"==e||"shinobigami"==e){const e=/(.*)\((.*)\) ＞ \((.*)\) ＞ (.*)/;return e.test(this.body)?this.body.replace(e,`$1<br>\n<span class="dice ${s}">($2) ＞ ($3) ＞ $4</span>`):this.body.replace(/(.*)\((.*)\)(.*)＞ (.*)/,`$1<br>\n<span class="dice ${s}">($2)$3＞ $4</span>`)}return this.body}class_name(e){return"メイン"==this.tab_name||null==this.tab_name||""==this.tab_name?"":"雑談"==this.tab_name?"other":"情報"==this.tab_name?"info":(console.log(e),"secret tab"+e.findIndex(e=>e.name==this.tab_name))}static fromObject(e=null){return new y(e)}get key(){return this._key}set key(e){this._key=e}get color(){return this._color}set color(e){this._color=e}get tab_name(){return this._tab_name}set tab_name(e){this._tab_name=e}get name(){return this._name}set name(e){this._name=e}get body(){return this._body}set body(e){this._body=e}get is_divider(){return this._is_divider}set is_divider(e){this._is_divider=e}get dice_type(){return this._dice_type}set dice_type(e){this._dice_type=e}get is_oneline(){return this._is_oneline}set is_oneline(e){this._is_oneline=e}get is_secret(){return this._is_secret}set is_secret(e){this._is_secret=e}}class g{constructor(e=null){this._file=this.paramFromObject(e,"file"),this._system=this.paramFromObject(e,"system","coc6"),this._header_color1=this.paramFromObject(e,"header_color1","#000"),this._header_color2=this.paramFromObject(e,"header_color2","#2E9BB1"),this._link_color=this.paramFromObject(e,"link_color","#fff"),this._title=this.paramFromObject(e,"title","【CoC】タイトル"),this._tabs=this.paramFromObject(e,"tabs",[]),this._doc="",this._rows=e?e["rows"].map(e=>y.fromObject(e)):[]}paramFromObject(e,t,s=null){return null==e||null==e[t]?s:e[t]}static fromObject(e=null){return new g(e)}get doc(){return this._doc}set doc(e){this._doc=e}get file(){return this._file}set file(e){this._file=e}get system(){return this._system}set system(e){this._system=e}get header_color1(){return this._header_color1}set header_color1(e){this._header_color1=e}get header_color2(){return this._header_color2}set header_color2(e){this._header_color2=e}get link_color(){return this._link_color}set link_color(e){this._link_color=e}get title(){return this._title}set title(e){this._title=e}get tabs(){return this._tabs}set tabs(e){this._tabs=e}get rows(){return this._rows}set rows(e){this._rows=e}format(e,t){const s=this.rows.filter(e=>e.is_divider),i=s.map(e=>`      <a href="#key${e.key}">${e.name}</a>`).join("\n");let a="";return this.tabs&&(a=this.tabs.reduce((e,t,s)=>(e+=`\n  .tab${s} {\n    background-color: ${t.background_color};\n    border-left:solid 2px ${t.line_color};\n  }\n`,e),"")),`\n<!DOCTYPE html>\n<html lang="ja">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <meta http-equiv="X-UA-Compatible" content="ie=edge" />\n    <title>${this.title}</title>\n  </head>\n  <header id="header">\n    <h1>${this.title}</h1>\n    <div class="menu">\n${i}\n    </div>\n  </header>\n  <body>\n    <div class="main">\n${this.rows.map(s=>s.format(this.system,this.tabs,e,t)).join("\n")}\n    </div>\n  </body>\n</html>\n<style type="text/css">\n  * {\n    margin: 0px;\n    padding: 0px;\n    font-family: sans-serif;\n  }\n  #header {\n    background: linear-gradient(${this.header_color1},${this.header_color2});\n    position: fixed;\n    width: 100%;\n    padding:10px;\n    opacity: 0.8;\n  }\n  #header a {\n    color: ${this.link_color};\n    text-decoration: none;\n    font-size: 14px;\n  }\n  #header a:hover{\n    text-decoration: underline;\n  }\n  h1 {\n    font-size: 18px;\n    color:${this.link_color};\n    font-weight:normal\n  }\n  h2 {\n    font-size: 16px;\n    text-align: center;\n  }\n  .menu {\n    padding-left: 10px;\n  }\n  /* ダイスロール結果 */\n  .dice {\n    font-weight: bold;\n    color: #555;\n  }\n  .dice.success {\n    color: #2196f3;\n  }\n  .dice.failed {\n    color: #f50057;\n  }\n  .main {\n    padding: 10px 1em 100px;\n    padding-bottom: 100px;\n    font-size: 14px;\n  }\n  .main div {\n    padding-top: 5px;\n    padding-bottom: 5px;\n  }\n  /* 情報タブ */\n  .info {\n    background-color: #fafafa;\n    border-left:solid 2px #bbb;    \n  }\n  /* 雑談タブ */\n  .other {\n    font-size: 12px;\n    margin-left: 50px;\n    padding-left: 10px;\n    padding-right: 10px;\n    background-color: #f7f7f7;\n    border-left:solid 1px #aaa;\n  }\n  /* 秘話 */\n  .secret {\n    font-size: 13px;\n    margin-left:50px;\n    padding-left:10px;\n    padding-right: 10px;\n  }\n${a}\n  .name-field {\n    display: inline-block;\n    font-weight: bold;\n    padding-right:5px;\n    vertical-align: top;\n  }\n  .text {\n    display: block;\n    word-break: break-word;\n  }\n  .day-line {\n    height: 1px;\n    background-color: #999999;\n    border: none;\n    margin: 10px 20px;\n  }\n  .day {\n    padding-top: 100px;\n  }\n  @media (min-width: 947px) {\n    /* 横幅が947px以上の場合に適用するスタイル */\n    .name-field {\n      text-align: right;\n      width: 120px;\n    }\n    .text {\n      display: inline-block;\n      width: 800px;\n      vertical-align: top;\n    }\n    .secret {\n      margin-left: 100px;\n    }\n  }\n</style>\n`}notFormat(e,t){return`<!DOCTYPE html>\n<html lang="ja">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <meta http-equiv="X-UA-Compatible" content="ie=edge" />\n    <title>ccfolia - logs</title>\n  </head>\n  <body>\n    \n${this.rows.map(s=>s.notFormat(e,t)).join("")}  </body>\n</html>`}}var v={name:"DiceResult",props:{visible:{type:Boolean,default:!1},system:{type:Object,default:()=>{}},names:{type:Array,default:()=>[]},initialSelectedNameTabs:{type:Array,default:()=>[]},ccfoliaLog:{type:g,default:g.fromObject()}},data(){return{selectedDiceResult:"",selectedDiceTabs:["メイン"],selectedNameTabs:[]}},computed:{diceRows:function(){return this.ccfoliaLog.rows.filter(e=>e.dice_type&&e.dice_type.resultKey==this.selectedDiceResult&&this.selectedDiceTabs.includes(e.tab_name)&&this.selectedNameTabs.includes(e.name))}},watch:{system(){null!=this.system.diceTypes&&this.system.diceTypes[0]&&(this.selectedDiceResult=this.system.diceTypes[0].resultKey)},initialSelectedNameTabs(e){this.selectedNameTabs=e}}},k=v,T=Object(h["a"])(k,b,_,!1,null,null,null),x=T.exports,w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",{staticClass:"mb-3",attrs:{shadow:"never"}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v("ヘッダー設定 "),s("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[s("div",{attrs:{slot:"content"},slot:"content"},[e._v("ヘッダー色とタイトルの設定ができます。"),s("br"),e._v("色は左と真ん中が背景色、右が文字色です。")]),s("el-button",{attrs:{icon:"el-icon-question",type:"text"}})],1)],1)]),s("el-color-picker",{attrs:{predefine:e.predefineColors},model:{value:e.headerColor1,callback:function(t){e.headerColor1=t},expression:"headerColor1"}}),s("el-color-picker",{attrs:{predefine:e.predefineColors},model:{value:e.headerColor2,callback:function(t){e.headerColor2=t},expression:"headerColor2"}}),s("el-color-picker",{attrs:{predefine:e.predefineColors},model:{value:e.linkColor,callback:function(t){e.linkColor=t},expression:"linkColor"}}),s("el-input",{staticClass:"mb-2",model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),s("div",{staticClass:"mb-3",style:"background:linear-gradient("+e.headerColor1+","+e.headerColor2+");color:"+e.linkColor},[s("div",{staticClass:"p-2"},[e._v(e._s(e.title))]),s("div",{staticClass:"p-2"},e._l(e.dividerRows,(function(t){return s("span",{key:t.name},[e._v(e._s(t.name)+" ")])})),0)])],1)},C=[],O={name:"DiceResult",mixins:[d],props:{initialHeaderColor1:{type:String,default:""},initialHeaderColor2:{type:String,default:""},initialLinkColor:{type:String,default:""},initialTitle:{type:String,default:""},dividerRows:{type:Array,default:()=>[]}},data(){return{headerColor1:this.initialHeaderColor1,headerColor2:this.initialHeaderColor2,linkColor:this.initialLinkColor,title:this.initialTitle}},watch:{headerColor1(e){this.$emit("changeHeaderColor1",e)},headerColor2(e){this.$emit("changeHeaderColor2",e)},linkColor(e){this.$emit("changeLinkColor",e)},title(e){this.$emit("changeTitle",e)}}},L=O,$=Object(h["a"])(L,w,C,!1,null,null,null),S=$.exports,j=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",{staticClass:"mb-3",attrs:{shadow:"never"}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v("タブ設定 "),s("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[s("div",{attrs:{slot:"content"},slot:"content"},[e._v("出力するタブを設定できます。"),s("br"),e._v("雑談、情報以外のタブの色の設定ができます。"),s("br"),e._v("左側がラインの色、右側が背景色です。")]),s("el-button",{attrs:{icon:"el-icon-question",type:"text"}})],1)],1)]),s("small",[e._v("チェックの入っているタブが出力されます。")]),s("el-checkbox-group",{model:{value:e.selectedOutputTabs,callback:function(t){e.selectedOutputTabs=t},expression:"selectedOutputTabs"}},[s("el-checkbox",{attrs:{label:"メイン"}}),s("el-checkbox",{attrs:{label:"情報"}}),s("el-checkbox",{attrs:{label:"雑談"}}),e._l(e.ccfoliaLog.tabs,(function(e,t){return s("el-checkbox",{key:t,attrs:{label:e.name}})}))],2),s("el-checkbox",{attrs:{label:"シークレットダイスを隠す",border:"",size:"small"},model:{value:e.isHideSecretDice,callback:function(t){e.isHideSecretDice=t},expression:"isHideSecretDice"}}),e.ccfoliaLog.tabs.length>0?s("el-divider"):e._e(),e.ccfoliaLog.tabs.length>0?s("div",{staticClass:"mb-2"},[e._v("色設定")]):e._e(),e._l(e.ccfoliaLog.tabs,(function(t){return s("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedOutputTabs.includes(t.name),expression:"selectedOutputTabs.includes(tab.name)"}],key:t.name},[s("el-color-picker",{attrs:{predefine:e.predefineColors},model:{value:t.line_color,callback:function(s){e.$set(t,"line_color",s)},expression:"tab.line_color"}}),s("el-color-picker",{attrs:{predefine:e.predefineColors},model:{value:t.background_color,callback:function(s){e.$set(t,"background_color",s)},expression:"tab.background_color"}}),s("div",{staticClass:"mb-3",style:"font-size:13px;background-color:"+t.background_color+";border-left:solid 2px "+t.line_color+";"},[s("div",{staticClass:"p-2"},[e._v(e._s(t.name))])])],1)}))],2)},F=[],H={name:"TabSetting",mixins:[d],props:{ccfoliaLog:{type:g,default:g.fromObject()},initialSelectedOutputTabs:{type:Array,default:()=>[]},inisitalIsHideSecretDice:{type:Boolean,default:!1}},data(){return{selectedOutputTabs:this.initialSelectedOutputTabs,isHideSecretDice:this.inisitalIsHideSecretDice}},watch:{initialSelectedOutputTabs:function(e){this.selectedOutputTabs=e},selectedOutputTabs:function(e){this.$emit("changeSelectedOutputTabs",e)},isHideSecretDice:function(e){this.$emit("changeIsHideSecretDice",e)}}},R=H,N=Object(h["a"])(R,j,F,!1,null,null,null),D=N.exports,E=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",{staticClass:"mb-4",attrs:{shadow:"never","body-style":{height:"95vh","overflow-y":"scroll"}}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v("ログ全文 "),s("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[s("el-button",{attrs:{icon:"el-icon-question",type:"text"}}),s("div",{attrs:{slot:"content"},slot:"content"},[e._v("+ボタンを押すとログに区切りを追加することができます。ヘッダーにもリンクが追加されます。"),s("br"),e._v("行ごと掴んで順序を入れ替えることができます。"),s("br"),e._v("磁石ボタンを押すと2回目に押した磁石ボタンまでの間にある同じタブ名の行をまとめることができます。")])],1)],1)]),s("draggable",{attrs:{options:{animation:200,handle:".handle"},list:e.ccfoliaLog.rows}},e._l(e.ccfoliaLog.rows,(function(t,i){return s("div",{key:i,staticClass:"my-1"},[t.is_divider?e._e():s("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedOutputTabs.includes(t.tab_name),expression:"selectedOutputTabs.includes(row.tab_name)"}],staticClass:"draggable handle",style:"color:"+t.color+";background-color:"+e.backgroundColor(t.tab_name)},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.addRow(i)}}},[e._v("+")]),s("el-button",{attrs:{size:"mini",icon:"el-icon-attract",type:e.attractButtonType(i),disabled:e.attractFrom&&i<e.attractFrom},on:{click:function(t){return e.attract(i)}}}),e._v(" ["+e._s(t.tab_name)+"] "+e._s(t.name)+"： "),s("span",{domProps:{innerHTML:e._s(t.body)}}),s("el-tag",{directives:[{name:"show",rawName:"v-show",value:t.is_secret,expression:"row.is_secret"}],attrs:{size:"mini",type:"warning"}},[e._v("シークレットダイス")])],1),t.is_divider?s("div",[s("el-row",{attrs:{gutter:5}},[s("el-col",{attrs:{span:1}},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.addRow(i)}}},[e._v("+")])],1),s("el-col",{attrs:{span:2}},[s("el-input",{attrs:{size:"mini",placeholder:"リンク名"},model:{value:t.name,callback:function(s){e.$set(t,"name",s)},expression:"row.name"}})],1),s("el-col",{attrs:{span:10}},[s("el-input",{attrs:{size:"mini",placeholder:"表示名"},model:{value:t.body,callback:function(s){e.$set(t,"body",s)},expression:"row.body"}})],1),s("el-col",{attrs:{span:1}},[s("el-button",{attrs:{size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.removeRow(i)}}})],1),s("el-col",{staticClass:"draggable handle text-white",attrs:{span:10}},[e._v(":")])],1)],1):e._e()])})),0)],1)},K=[],M=s("b76a"),z=s.n(M),B={name:"TabSetting",mixins:[d],components:{draggable:z.a},props:{initialCcfoliaLog:{type:g,default:g.fromObject()},selectedOutputTabs:{type:Array,default:()=>[]},dividerRows:{type:Array,default:()=>[]}},data(){return{ccfoliaLog:this.initialCcfoliaLog,attractFrom:null,dogs:[]}},methods:{addRow(e){this.ccfoliaLog.rows.splice(e,0,y.fromObject({is_divider:!0,name:"",body:"",key:this.dividerRows.length}))},removeRow(e){this.ccfoliaLog.rows.splice(e,1)},attract(e){if(this.attractFrom===e)return this.attractFrom=null,void(this.dogs=[]);if(null===this.attractFrom)return void(this.attractFrom=e);if(this.dogs.includes(e))return void(this.dogs=this.dogs.filter(t=>t!=e));if(this.ccfoliaLog.rows[this.attractFrom].tab_name!=this.ccfoliaLog.rows[e].tab_name)return void this.dogs.push(e);const t=this.ccfoliaLog.rows,s=t[this.attractFrom].tab_name,i=this.dogs;for(let a=this.attractFrom+1;a<=e;a++)(i.includes(a)||t[a].tab_name===s)&&(t.splice(this.attractFrom+1,0,t.splice(a,1)[0]),this.attractFrom++);this.attractFrom=null,this.dogs=[]},attractButtonType(e){return this.attractFrom==e?"info":this.dogs.includes(e)?"warning":null==this.attractFrom||e<this.attractFrom||this.ccfoliaLog.rows[e].tab_name!=this.ccfoliaLog.rows[this.attractFrom].tab_name?null:"primary"}},watch:{initialCcfoliaLog:function(e){this.ccfoliaLog=e},ccfoliaLog:function(e){this.$emit("changeCcFoliaLog",e)}}},P=B,A=Object(h["a"])(P,E,K,!1,null,null,null),I=A.exports,q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("small",[s("div",[e._v("最終更新: 2024-01-25 "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.drawer=!0}}},[e._v("履歴")])],1),e._m(0)]),s("el-drawer",{attrs:{title:"履歴",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[s("ul",{staticStyle:{"font-size":"0.9em"}},[s("li",[e._v("2024-01-25 選択したタブ以外も出力されてしまうのを修正")]),s("li",[e._v("2024-01-23 整形したログを整形するとダイス表示がおかしくなるのを修正")]),s("li",[e._v("2023-09-11 タブごとに行をまとめる時に他のタブも巻き込めるように変更")]),s("li",[e._v("2023-06-19 整形したログを再度読み込めるように変更")]),s("li",[e._v("2023-03-26 タブごとに行をまとめる機能を追加")]),s("li",[e._v("2022-10-26 整形しないでダウンロードする機能を追加")]),s("li",[e._v("2022-09-06 本文の順序入れ替え時にフォーム部分が反応しないように修正")]),s("li",[e._v("2022-05-30 シークレットダイスの判定を修正")]),s("li",[e._v("2022-05-20 シークレットダイスの判定を修正")]),s("li",[e._v("2022-05-07 インセイン、シノビガミに対応")]),s("li",[e._v("2022-04-26 シークレットダイスの結果を隠せるように変更")]),s("li",[e._v("2022-04-22 出力するタブを選択できるように変更")]),s("li",[e._v("2022-02-06 タブ色設定の初期色を変更")]),s("li",[e._v("2021-09-14 ヘッダーのタイトル色が変更されないのを修正")]),s("li",[e._v("2021-06-27 背景色が編集パネルに反映されるように変更")]),s("li",[e._v("2021-06-06 ダイス結果を名前で絞り込めるように変更")]),s("li",[e._v("2021-03-29 エモクロアTRPGに対応")]),s("li",[e._v("2021-03-15 リンクが効かない不具合の修正")]),s("li",[e._v("2021-03-13 本文の順序を入れ替える機能を追加")]),s("li",[e._v("2021-02-27 一行のダイス結果表記に対応")]),s("li",[e._v("2021-02-23 公開")])])])],1)},U=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mb-4"},[e._v("Twitter: "),s("a",{attrs:{href:"https://twitter.com/inouemoku",target:"_blank"}},[e._v("@inouemoku")])])}],G={name:"Histories",data(){return{drawer:!1}}},J=G,X=Object(h["a"])(J,q,U,!1,null,null,null),Y=X.exports,V={name:"CcfoliaFormatter",mixins:[d],components:{SystemForm:f,DiceResult:x,HeaderSetting:S,TabSetting:D,LogEditor:I,Histories:Y},data(){return{ccfoliaLog:g.fromObject(),system:{},selectedNameTabs:[],selectedOutputTabs:[],names:[],isHideSecretDice:!1,filename:""}},props:{},methods:{selectSystem(e){this.ccfoliaLog.system=e},changeHeaderColor1(e){this.ccfoliaLog.header_color1=e},changeHeaderColor2(e){this.ccfoliaLog.header_color2=e},changeLinkColor(e){this.ccfoliaLog.link_color=e},changeTitle(e){this.ccfoliaLog.title=e},changeIsHideSecretDice(e){this.isHideSecretDice=e},changeSelectedOutputTabs(e){console.log(e),this.selectedOutputTabs=e},changeCcfoliaLog(e){this.ccfoliaLog=e},postCcfoliaLog(){this.downloadBlob(this.ccfoliaLog.format(this.selectedOutputTabs,this.isHideSecretDice),this.filename.replace(/^(.*).html$/,"$1_整形.html"),"text/html")},postOriginalCcfoliaLog(){this.downloadBlob(this.ccfoliaLog.notFormat(this.selectedOutputTabs,this.isHideSecretDice),this.filename,"text/html")},handleChangeFile(e){this.ccfoliaLog.file=e,this.system=this.systems.find(e=>e.key==this.ccfoliaLog.system);const t=this.ccfoliaLog.file.name.replace(/^(.*).html$/,"$1").replace(/^(.*)\[all\]$/,"$1");this.ccfoliaLog.title=`${this.system.prefix}${t}`,this.filename=this.ccfoliaLog.file.name,this.analyzeHtml()},downloadBlob(e,t,s){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,t);else{const i=URL.createObjectURL(new Blob([e],{type:s})),a=document.createElement("a");a.href=i,a.setAttribute("download",t),document.body.appendChild(a),a.click(),URL.revokeObjectURL(i),a.parentNode.removeChild(a)}},analyzeHtml(){const e=new FileReader,t=this;e.onload=function(){const s=new DOMParser,i=s.parseFromString(e.result,"text/html"),a=i.getElementsByTagName("parsererror");if(a.length>0)return t.$message({type:"error",message:"ファイルの解析に失敗しました"}),void console.log(a);const n=i.getElementsByClassName("main"),{ccfoliaLog:l,names:o,selectedNameTabs:r,uniqTabs:c}=n.length>0?t.analyzeHtmlMochiMochi(i):t.analyzeHtmlCcfolia(i);t.ccfoliaLog=l,t.names=o,t.selectedNameTabs=r,t.selectedOutputTabs=c,console.log("onload end")},e.readAsText(this.ccfoliaLog.file.raw)},analyzeHtmlCcfolia(e){let t=g.fromObject();const s=Array.from(e.getElementsByTagName("p"));t.rows=s.map(e=>{const{isOneline:t,diceType:s,isSecret:i}=this.diceType(e.children[2].innerHTML),a={color:e.outerHTML.match(/<p style="color:(.*);">/)[1],tab_name:e.children[0].innerText.replace(/^ \[(.*)\]/,"$1"),name:e.children[1].innerText,body:e.children[2].innerHTML,dice_type:s,is_oneline:t,is_secret:i};return y.fromObject(a)});const{names:i,selectedNameTabs:a}=t.rows.filter(e=>null!=e.dice_type).reduce(({names:e,selectedNameTabs:t},s)=>(e.includes(s.name)||(e.push(s.name),t.push(s.name)),{names:e,selectedNameTabs:t}),{names:[],selectedNameTabs:[]}),n=[...new Set(t.rows.map(e=>e.tab_name))],l=y.fromObject({key:0,is_divider:!0,name:"1",body:"1日目"}),o=n.reduce((e,s)=>("メイン"!=s&&"雑談"!=s&&"情報"!=s&&e.push(this.tabColors(t.rows,s)),e),[]);return t.rows=[l].concat(t.rows),t.tabs=o,{ccfoliaLog:t,names:i,selectedNameTabs:a,uniqTabs:n}},analyzeHtmlMochiMochi(e){let t=g.fromObject();const s=Array.from(e.getElementById("header").children);t.title=s[0].innerText;const i=Array.from(s[1].children).map(e=>({key:e.hash.slice(1),name:e.innerText})),a=Array.from(e.getElementsByClassName("main")[0].children),n=e.getElementsByTagName("style")[0].innerText,l=this.parseCssToObject(n),o=l.find(e=>"#header"==e.key).contents.background.match(/linear-gradient\((#.*),(#.*)\)/);t.header_color1=o[1],t.header_color2=o[2];const r=function(e){return"#"+e.match(/\d+/g).map((function(e){return("0"+parseInt(e).toString(16)).slice(-2)})).join("")};t.rows=a.map(e=>{if("day-line"==e.className)return;if("day"==e.className){const t=e.id.slice(3),s=y.fromObject({key:t,is_divider:!0,name:i.find(e=>e.key.slice(3)==t).name,body:e.innerText});return s}const t=this.diceTypeMochi(e.children[1]),s=null==t?e.children[1].innerHTML:this.htmlSpecialChars(""+e.children[1].innerText),{isOneline:a,diceType:n,isSecret:l}=this.diceType(s),o={color:r(e.style.color),tab_name:this.tabNameMochi(e),name:e.children[0].children[0].innerText.slice(0,-2),body:s,dice_type:n,is_oneline:a,is_secret:l};return y.fromObject(o)}).filter(e=>e);const{names:c,selectedNameTabs:d}=t.rows.filter(e=>null!=e.dice_type).reduce(({names:e,selectedNameTabs:t},s)=>(e.includes(s.name)||(e.push(s.name),t.push(s.name)),{names:e,selectedNameTabs:t}),{names:[],selectedNameTabs:[]}),m=[...new Set(t.rows.map(e=>e.tab_name))].filter(e=>e);var u=0;const h=m.reduce((e,s)=>{if("メイン"!=s&&"雑談"!=s&&"情報"!=s){const i=l.find(e=>e.key==".tab"+u).contents,a=i["border-left"].match(/.*(#.*)/)[1],n=i["background-color"];u+=1,e.push(this.tabColors(t.rows,s,a,n))}return e},[]);return t.tabs=h,{ccfoliaLog:t,names:c,selectedNameTabs:d,uniqTabs:m}},htmlSpecialChars(e){var t=document.createTextNode(e),s=document.createElement("p");return s.appendChild(t),s.innerHTML},tabNameMochi(e){return null!=e.attributes["tab-name"]?e.attributes["tab-name"].nodeValue:null==e.classList[0]?"メイン":"info"==e.classList[0]?"情報":"other"==e.classList[0]?"雑談":"secret"==e.classList[0]?e.classList[1]:void 0},diceTypeMochi(e){if(null==e.children[1])return null;const t=e.children[1].classList[1];return null==t?"dice":t},parseCssToObject(e){var t=[],s=e.match(/(.*){([^{}]+)}/g);return s&&s.forEach(e=>{const s=/(.*)\s*{([^}]*)}/,i=e.match(s);if(i){const e=i[1].trim(),s=i[2].trim();var a={};s.split(";").forEach((function(e){e=e.replace(/\r?\n? /g,"");var t=e.split(":");if(0!=t[0].length){var s=t[0].trim(),i=t[1].trim();a[s]=i}})),t.push({key:e,contents:a})}}),t},tabColors(e,t,s=null,i=null){if(null!=s&&null!=i)return{name:t,line_color:s,background_color:i};const a=e.filter(e=>!e.is_divider&&e.tab_name===t&&"#222222"!==e.color&&"#888888"!==e.color&&!e.name.match(/GM|KP|DL/));if(console.log(a),0===a.length)return{name:t,line_color:"#aaa",background_color:"#f7f7f7"};const n=a.reduce((e,t)=>e&&e.color!==t.color?e:t,null);return{name:t,line_color:n.color,background_color:this.convertToPaleColorSharp(n.color,.05)}},compositeColor(e,t){const s=parseInt(e,16)*t+255*(1-t);return Math.floor(s).toString(16)},convertToPaleColor(e,t){const s=[e.slice(0,2),e.slice(2,4),e.slice(4,6)];return s.map(e=>this.compositeColor(e,t)).join("")},convertToPaleColorSharp(e,t){const s=e.slice(1);return"#"+this.convertToPaleColor(s,t)},diceType(e){const{system:t}=this,s=/\n\s*[sS]/.test(e),i=!/.*${system.diceText} :.*＞.*/.test(e),a=e.match(/(.*)\((.*)\)(.*)＞ (.*)/);if(i){const i=new RegExp(`.*＞ (${t.diceTypes.map(e=>e.name).join("|")})`),n=e.match(i);if(n){const e=t.diceTypes.find(e=>e.name===n[1]);return{isOneline:!0,diceType:e,isSecret:s}}return a?{isOneline:!0,diceType:null,isSecret:s}:{isOneline:!0,diceType:null,isSecret:!1}}const n=new RegExp(`.*${t.diceText} :.*＞ (${t.diceTypes.map(e=>e.name).join("|")})`),l=e.match(n);if(l){const e=t.diceTypes.find(e=>e.name===l[1]);return{isOneLlne:!1,diceType:e,isSecret:s}}return a?{isOneline:!1,diceType:null,isSecret:s}:{isOneline:!1,diceType:null,isSecret:!1}},backgroundColor(e){return"メイン"==e?"#ffffff":"雑談"==e?"#f7f7f7":"情報"==e?"#fafafa":this.ccfoliaLog.tabs.find(t=>t.name==e).background_color}},computed:{dividerRows:function(){return this.ccfoliaLog.rows.filter(e=>e.is_divider)}}},Q=V,W=(s("0211"),Object(h["a"])(Q,l,o,!1,null,null,null)),Z=W.exports,ee={name:"App",components:{CcfoliaFormatter:Z}},te=ee,se=Object(h["a"])(te,a,n,!1,null,null,null),ie=se.exports,ae=s("5c96"),ne=s.n(ae),le=s("c3ff"),oe=s.n(le),re=s("4897"),ce=s.n(re);s("0fae"),s("e05f"),s("f9e3"),s("2dd8");ce.a.use(oe.a),i["default"].use(ne.a),i["default"].config.productionTip=!0,new i["default"]({render:e=>e(ie)}).$mount("#app")}});
//# sourceMappingURL=app.394dcdb9.js.map